var app=angular.module("glint",["glint.services","glint.ideas","glint.votes","glint.auth","glint.comments","ngAnimate","ngRoute"]).config(function(a){a.when("/",{templateUrl:"app/ideas/ideas.html"}).when("/board/:name",{templateUrl:"app/ideas/ideas.html"}).when("/user/:name",{templateUrl:"app/ideas/ideas.html"}).when("/login",{templateUrl:"app/auth/login.html"}).when("/signup",{templateUrl:"app/auth/signup.html"}).otherwise({redirectTo:"/"})}).filter("moment",function(){return function(a){return moment(a).fromNow()}}),glintServices=angular.module("glint.services",[]);glintServices.factory("Ideas",function(a){var b=function(b){return a({method:"GET",url:"/api/ideas",params:b}).then(function(a){return a.data})["catch"](function(a){console.error("getIdeas error",a)})},c=function(b){return a({method:"POST",url:"/api/ideas",data:b}).then(function(a){return a.data})["catch"](function(a){console.error("createIdeas error",a)})};return{getIdeas:b,createIdea:c}}),glintServices.factory("Votes",function(a){var b=function(b){return a({method:"POST",url:"/api/vote/upvote",data:b}).then(function(a){return a.data})["catch"](function(a){console.error("upvote error",a)})},c=function(b){return a({method:"POST",url:"/api/vote/downvote",data:b}).then(function(a){return a.data})["catch"](function(a){console.error("downvote error",a)})};return{upvote:b,downvote:c}}),glintServices.factory("Auth",function(a,b){var c=b.localStorage.getItem("com.glinted");("undefined"===c||null===c)&&(c=JSON.stringify({data:null}));var d=JSON.parse(c).data,e=function(b){return a({method:"POST",url:"/api/users/signin",data:b}).then(function(a){return a.data})["catch"](function(a){console.error("login error",a)})},f=function(b){return a({method:"POST",url:"/api/users/signup",data:b}).then(function(a){return a.data})["catch"](function(a){console.error("signup error",a)})},g=function(){var a={data:d};b.localStorage.setItem("com.glinted",JSON.stringify(a))},h=function(){b.localStorage.removeItem("com.glinted")};return{login:e,signup:f,logout:h,user:d,update:g}}),glintServices.factory("Comments",function(a){var b=function(b){return a({method:"POST",url:"/api/comments",data:b}).then(function(a){return a.data})["catch"](function(a){console.error("createComments error",a)})},c=function(b){return a({method:"GET",url:"/api/comments",params:{idea_id:b}}).then(function(a){return a.data})["catch"](function(a){console.error("getComments error",a)})};return{createComment:b,getComments:c}}),angular.module("glint.ideas",[]).controller("IdeasCtrl",function(a,b,c,d,e){var f=this;f.data={ideas:[]},f.idea={},f.postSuccess=!1,f.submitted=!1,f.Auth=d,b.$on("$routeChangeSuccess",function(){var a=e.path().split("/");if(a.length>2){var b={};"user"===a[1]&&(a[1]="created_by"),b[a[1]]=a[2],f.displayIdeas(b)}else f.displayIdeas({board:""})}),f.logout=function(){f.Auth.user=null,d.logout()},f.displayIdeas=function(b){a.getIdeas(b).then(function(a){a=c("orderBy")(a,"votes",!0),f.data.ideas=a})["catch"](function(a){console.error("displayIdeas error",a)})},f.submitIdea=function(){if(!f.Auth.user)return void e.path("/login");if(f.submitted===!1)f.submitted=!0;else{f.idea.title=_.escape(f.idea.title),f.idea.text=_.escape(f.idea.text),f.idea.created_by=f.Auth.user.username,f.idea.board=e.path().split("/").slice(-1)[0];var b=JSON.stringify(f.idea);a.createIdea(b).then(function(){f.postSuccess=!0,f.submitted=!1,f.idea={},f.displayIdeas()})["catch"](function(a){console.error("createIdea error",a)})}},f.displayIdeas()}),angular.module("glint.votes",[]).controller("VotesCtrl",function(a,b,c,d){var e=this;e.upvote=function(a,e){if(!c.user)return void d.path("/login");if(!(c.user.wallet-e<0||c.user.username===a.created_by)){var f=a;a={idea:a,gCount:e,username:c.user.username},a=JSON.stringify(a),f.votes+=e,c.user.wallet-=e,c.update(),b.upvote(a).then(function(){})["catch"](function(a){console.error("upvote error",a)})}},e.downvote=function(a){var c=a;a=JSON.stringify(a),b.downvote(a).then(function(){c.votes--})["catch"](function(a){console.error("downvote error",a)})}}),angular.module("glint.auth",[]).controller("AuthCtrl",function(a,b,c){var d=this;d.user={},d.login=function(){d.user.username=_.escape(d.user.username),d.user.password=_.escape(d.user.password);var e=JSON.stringify(d.user);c.login(e).then(function(d){a.localStorage.setItem("com.glinted",JSON.stringify(d)),c.user=d.data,b.path("/")})["catch"](function(a){console.error("login error",a)})},d.signup=function(){d.user.username=_.escape(d.user.username),d.user.password=_.escape(d.user.password);var e=JSON.stringify(d.user);c.signup(e).then(function(d){a.localStorage.setItem("com.glinted",JSON.stringify(d)),c.user=d.data,b.path("/")})["catch"](function(a){console.error("signup error",a)})}}),angular.module("glint.comments",[]).controller("CommentsCtrl",function(a,b){var c=this;c.comment={},c.comments=[""],c.viewingComments=!1,c.submitComment=function(d){c.comment.idea_id=d,c.comment.created_by=b.user.username,comment=JSON.stringify(c.comment),c.comment={},a.createComment(comment).then(function(a){c.comments.unshift(a)})["catch"](function(a){console.error("comment error",a)})},c.displayComments=function(b){c.viewingComments?c.viewingComments=!1:(c.viewingComments=!0,a.getComments(b).then(function(a){c.comments=a.reverse()})["catch"](function(a){console.error("displayComments error",a)}))}});